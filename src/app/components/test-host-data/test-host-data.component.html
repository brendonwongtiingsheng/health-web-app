<div class="test-host-data-container">
  <div class="test-header">
    <h1>ğŸ§ª MFE APIé›†æˆæµ‹è¯•</h1>
    <p>æµ‹è¯•ä»Hoståº”ç”¨è·å–access tokenå¹¶è°ƒç”¨APIçš„åŠŸèƒ½</p>
  </div>

  <!-- çŠ¶æ€æ¦‚è§ˆ -->
  <div class="status-overview">
    <div class="status-card">
      <h3>ğŸ“Š Hostæ•°æ®çŠ¶æ€</h3>
      <div class="status-grid">
        <div class="status-item">
          <span class="status-label">ç”¨æˆ·ID:</span>
          <span [class]="hostData.userId ? 'status-success' : 'status-error'">
            {{ hostData.userId ? 'âœ… ' + hostData.userId : 'âŒ æœªè·å–' }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">ç”¨æˆ·é…ç½®:</span>
          <span [class]="hostData.userProfile ? 'status-success' : 'status-error'">
            {{ hostData.userProfile ? 'âœ… å·²è·å–' : 'âŒ æœªè·å–' }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">APIå‡­æ®:</span>
          <span [class]="hostData.apiCredentials ? 'status-success' : 'status-error'">
            {{ hostData.apiCredentials ? 'âœ… å·²è·å–' : 'âŒ æœªè·å–' }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">ä¼šè¯æ•°æ®:</span>
          <span [class]="hostData.sessionData ? 'status-success' : 'status-error'">
            {{ hostData.sessionData ? 'âœ… å·²è·å–' : 'âŒ æœªè·å–' }}
          </span>
        </div>
      </div>
    </div>

    <div class="status-card" *ngIf="apiCredentials">
      <h3>ğŸ”‘ APIå‡­æ®è¯¦æƒ…</h3>
      <div class="status-grid">
        <div class="status-item">
          <span class="status-label">Access Token:</span>
          <span [class]="apiCredentials.accessToken ? 'status-success' : 'status-error'">
            {{ apiCredentials.accessToken ? 'âœ… å·²è·å– (' + apiCredentials.accessToken.substring(0, 20) + '...)' : 'âŒ æœªè·å–' }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">X-API-Key:</span>
          <span [class]="apiCredentials.xApiKey ? 'status-success' : 'status-error'">
            {{ apiCredentials.xApiKey ? 'âœ… å·²è·å–' : 'âŒ æœªè·å–' }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">Base URL:</span>
          <span [class]="apiCredentials.baseUrlBFF ? 'status-success' : 'status-error'">
            {{ apiCredentials.baseUrlBFF ? 'âœ… ' + apiCredentials.baseUrlBFF : 'âŒ æœªè·å–' }}
          </span>
        </div>
        <div class="status-item" *ngIf="apiCredentials.tokenExpiry">
          <span class="status-label">Tokenè¿‡æœŸæ—¶é—´:</span>
          <span class="status-info">{{ apiCredentials.tokenExpiry }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
  <div class="test-controls">
    <h3>ğŸ® æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
    
    <div class="control-section">
      <h4>åŸºç¡€æµ‹è¯•</h4>
      <div class="button-group">
        <button 
          class="test-btn primary" 
          (click)="refreshHostData()" 
          [disabled]="isLoading">
          ğŸ”„ åˆ·æ–°Hostæ•°æ®
        </button>
        
        <button 
          class="test-btn secondary" 
          (click)="testApiCredentials()" 
          [disabled]="isLoading">
          ğŸ”‘ æµ‹è¯•å‡­æ®è·å–
        </button>
        
        <button 
          class="test-btn secondary" 
          (click)="testApiConnection()" 
          [disabled]="isLoading">
          ğŸŒ æµ‹è¯•APIè¿æ¥
        </button>
        
        <button 
          class="test-btn warning" 
          (click)="refreshApiCredentials()" 
          [disabled]="isLoading">
          ğŸ”„ åˆ·æ–°APIå‡­æ®
        </button>
      </div>
    </div>

    <div class="control-section">
      <h4>APIè°ƒç”¨æµ‹è¯•</h4>
      <div class="api-test-section">
        <div class="input-group">
          <label for="policyNumber">ä¿å•å·:</label>
          <input 
            id="policyNumber"
            type="text" 
            [(ngModel)]="testPolicyNumber" 
            placeholder="è¾“å…¥æµ‹è¯•ä¿å•å·"
            class="policy-input">
        </div>
        
        <button 
          class="test-btn success" 
          (click)="testGetInsured()" 
          [disabled]="isLoading || !testPolicyNumber">
          ğŸ‘¤ è·å–è¢«ä¿é™©äººä¿¡æ¯
        </button>
      </div>
    </div>

    <div class="control-section">
      <h4>SecureStorage æµ‹è¯•</h4>
      <div class="button-group">
        <button 
          class="test-btn info" 
          (click)="testSecureStorage()" 
          [disabled]="isLoading">
          ğŸ”§ æµ‹è¯•SecureStorageçŠ¶æ€
        </button>
        
        <button 
          class="test-btn secondary" 
          (click)="setTestCredentialsToSecureStorage()" 
          [disabled]="isLoading">
          ğŸ’¾ è®¾ç½®æµ‹è¯•å‡­æ®
        </button>
        
        <button 
          class="test-btn danger" 
          (click)="clearSecureStorageCredentials()" 
          [disabled]="isLoading">
          ğŸ§¹ æ¸…é™¤SecureStorageå‡­æ®
        </button>
      </div>
    </div>

    <div class="control-section">
      <h4>è°ƒè¯•å·¥å…·</h4>
      <div class="button-group">
        <button 
          class="test-btn info" 
          (click)="showDebugInfo()">
          ğŸ› æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        </button>
        
        <button 
          class="test-btn info" 
          (click)="debugAccessToken()">
          ğŸ” è°ƒè¯• Access Token
        </button>
        
        <button 
          class="test-btn info" 
          (click)="showFullAccessToken()">
          ğŸ”‘ æ˜¾ç¤ºå®Œæ•´ Token
        </button>
        
        <button 
          class="test-btn info" 
          (click)="testAllTokenSources()">
          ğŸ§ª æµ‹è¯•æ‰€æœ‰Tokenæ¥æº
        </button>
        
        <button 
          class="test-btn info" 
          (click)="exportTestData()">
          ğŸ“ å¯¼å‡ºæµ‹è¯•æ•°æ®
        </button>
        
        <button 
          class="test-btn danger" 
          (click)="clearResults()">
          ğŸ§¹ æ¸…é™¤ç»“æœ
        </button>
      </div>
    </div>
  </div>

  <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
  <div class="loading-indicator" *ngIf="isLoading">
    <div class="spinner"></div>
    <span>å¤„ç†ä¸­...</span>
  </div>

  <!-- æµ‹è¯•ç»“æœæ˜¾ç¤º -->
  <div class="test-results" *ngIf="hasTestResults()">
    <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>

    <!-- è¢«ä¿é™©äººä¿¡æ¯è·å–ç»“æœ -->
    <div class="result-card" *ngIf="certificateTestResult">
      <h4>ğŸ‘¤ è¢«ä¿é™©äººä¿¡æ¯è·å–ç»“æœ</h4>
      <div class="result-header">
        <span [class]="certificateTestResult.success ? 'result-success' : 'result-error'">
          {{ certificateTestResult.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥' }}
        </span>
        <span class="result-time">{{ certificateTestResult.timestamp | date:'medium' }}</span>
      </div>
      
      <div class="result-details">
        <div class="detail-item">
          <strong>ä¿å•å·:</strong> {{ certificateTestResult.policyNumber }}
        </div>
        
        <div *ngIf="certificateTestResult.success && certificateTestResult.data" class="detail-item">
          <strong>APIå“åº”:</strong>
          <pre class="json-display">{{ certificateTestResult.data | json }}</pre>
        </div>
        
        <div *ngIf="!certificateTestResult.success" class="detail-item error">
          <strong>é”™è¯¯ä¿¡æ¯:</strong> {{ certificateTestResult.error }}
        </div>
      </div>
    </div>

    <!-- å…¶ä»–æµ‹è¯•ç»“æœ -->
    <div class="result-card" *ngFor="let result of getTestResultEntries()">
      <h4>{{ getTestResultTitle(result.key) }}</h4>
      <div class="result-header">
        <span [class]="result.value?.success ? 'result-success' : 'result-error'">
          {{ result.value?.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥' }}
        </span>
        <span class="result-time">{{ result.value?.timestamp | date:'medium' }}</span>
      </div>
      
      <div class="result-details">
        <div *ngIf="result.value?.message" class="detail-item">
          <strong>æ¶ˆæ¯:</strong> {{ result.value.message }}
        </div>
        
        <div *ngIf="result.value?.data" class="detail-item">
          <strong>æ•°æ®:</strong>
          <pre class="json-display">{{ result.value.data | json }}</pre>
        </div>
        
        <div *ngIf="result.value?.error" class="detail-item error">
          <strong>é”™è¯¯:</strong> {{ result.value.error }}
        </div>
      </div>
    </div>
  </div>

  <!-- ä½¿ç”¨è¯´æ˜ -->
  <div class="usage-guide">
    <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
    <div class="guide-content">
      <ol>
        <li><strong>æ£€æŸ¥çŠ¶æ€:</strong> é¦–å…ˆæŸ¥çœ‹"Hostæ•°æ®çŠ¶æ€"å’Œ"APIå‡­æ®è¯¦æƒ…"ç¡®è®¤æ•°æ®æ˜¯å¦æ­£ç¡®è·å–</li>
        <li><strong>åˆ·æ–°æ•°æ®:</strong> å¦‚æœæ•°æ®ä¸å®Œæ•´ï¼Œç‚¹å‡»"åˆ·æ–°Hostæ•°æ®"é‡æ–°è·å–</li>
        <li><strong>æµ‹è¯•å‡­æ®:</strong> ç‚¹å‡»"æµ‹è¯•å‡­æ®è·å–"éªŒè¯èƒ½å¦ä»Hostè·å–APIå‡­æ®</li>
        <li><strong>æµ‹è¯•è¿æ¥:</strong> ç‚¹å‡»"æµ‹è¯•APIè¿æ¥"éªŒè¯APIæœåŠ¡æ˜¯å¦å¯ç”¨</li>
        <li><strong>SecureStorage:</strong> æµ‹è¯•æœ¬åœ°å®‰å…¨å­˜å‚¨åŠŸèƒ½ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®æµ‹è¯•å‡­æ®</li>
        <li><strong>è°ƒç”¨API:</strong> è¾“å…¥ä¿å•å·ï¼Œç‚¹å‡»"è·å–è¢«ä¿é™©äººä¿¡æ¯"æµ‹è¯•ä½ çš„APIè°ƒç”¨ï¼ˆç°åœ¨æ”¯æŒSecureStorageï¼‰</li>
        <li><strong>å¤„ç†é”™è¯¯:</strong> å¦‚æœé‡åˆ°401é”™è¯¯ï¼Œç‚¹å‡»"åˆ·æ–°APIå‡­æ®"ç„¶åé‡è¯•</li>
        <li><strong>è°ƒè¯•é—®é¢˜:</strong> ä½¿ç”¨"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯"å’Œ"å¯¼å‡ºæµ‹è¯•æ•°æ®"æ¥åˆ†æé—®é¢˜</li>
      </ol>
      
      <div class="important-note">
        <strong>âš ï¸ é‡è¦æç¤º:</strong>
        <ul>
          <li>APIç°åœ¨æ”¯æŒä»SecureStorageå’ŒHostä¸¤ç§æ–¹å¼è·å–å‡­æ®</li>
          <li>åœ¨ç§»åŠ¨ç«¯ç¯å¢ƒä¸­ä¼šä¼˜å…ˆä½¿ç”¨SecureStorage</li>
          <li>åœ¨Webç¯å¢ƒä¸­SecureStorageä¼šfallbackåˆ°localStorage</li>
          <li>ç¡®ä¿Hoståº”ç”¨å·²æ­£ç¡®è®¾ç½®APIå‡­æ®</li>
          <li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†æ—¥å¿—ä¿¡æ¯</li>
          <li>å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIæœåŠ¡çŠ¶æ€</li>
        </ul>
      </div>

      <div class="api-changes">
        <strong>ğŸ”„ APIå˜æ›´è¯´æ˜:</strong>
        <ul>
          <li>APIç«¯ç‚¹å·²æ›´æ”¹ä¸º: <code>/v1/policies/insured</code></li>
          <li>æ”¯æŒSecureStorageå‡­æ®è·å–</li>
          <li>è‡ªåŠ¨tokenåˆ·æ–°å’Œé‡è¯•æœºåˆ¶</li>
          <li>30ç§’è¯·æ±‚è¶…æ—¶è®¾ç½®</li>
        </ul>
      </div>
    </div>
  </div>
</div>